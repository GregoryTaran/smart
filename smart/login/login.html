<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- БАЗА ДЛЯ ВСЕХ ПУТЕЙ ВНУТРИ /smart -->
  <base href="../" />

  <title>SMART VISION — Вход (SVID)</title>

  <link rel="icon" href="assets/logo400.jpg" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="login/login.css" />


  <script>
    (function () {
      // Значения по умолчанию: гость
      window.SV_AUTH = {
        isAuthenticated: false,
        userId: null,
        level: 1,
        levelCode: 'guest',
        email: null,
        displayName: null,
        loaded: false
      };

      function applySession(data) {
        window.SV_AUTH.isAuthenticated = !!data.is_authenticated;
        window.SV_AUTH.userId = data.user_id ?? null;
        window.SV_AUTH.level = data.level ?? 1;
        window.SV_AUTH.levelCode =
          data.level_code || (window.SV_AUTH.level === 1 ? 'guest' : 'user');
        window.SV_AUTH.email = data.email ?? null;
        window.SV_AUTH.displayName = data.display_name ?? null;
        window.SV_AUTH.loaded = true;

        // Сообщаем всем, что авторизация прогружена
        document.dispatchEvent(
          new CustomEvent('sv:auth-ready', { detail: window.SV_AUTH })
        );
      }

      // Тянем сессию с бэка
      fetch('/api/auth/session', {
        method: 'GET',
        credentials: 'include'
      })
        .then(function (res) {
          if (!res.ok) throw new Error('Auth check failed');
          return res.json();
        })
        .then(applySession)
        .catch(function () {
          // В случае ошибки остаёмся гостем
          applySession({});
        });
    })();
  </script>



  <!-- наш модуль -->
  <script type="module">
    import { initPage } from "./js/topbar.module.js";
    initPage({
      fragments: [["menu.html", "#sidebar"]],
      cacheBust: false,
      topbar: {
        state: { logoHref: "index.html", logoSrc: "assets/logo400.jpg", auth: { user: null } }
      }
    });
  </script>


</head>
<body>
  <div id="page">
    <aside id="sidebar" aria-label="Основное меню"></aside>
    <div id="app">
      <header id="topbar" role="banner"></header>

      <main id="main" role="main">
        
        
        
        
   <section class="login">
  <div class="login__box sv-center-700">
    <!-- общий заголовок -->
    <h1 class="login__title">ВХОД | РЕГИСТРАЦИЯ</h1>

    <!-- Общий статус -->
    <div class="login__status" id="svid-status" role="status" aria-live="polite"></div>

    <!-- ===== ЭКРАН РЕГИСТРАЦИИ ===== -->
    <form class="login__form" id="svid-form-register" data-svid-form="register" novalidate>
      <label class="login__label" for="reg-name">
        Имя
        <input
          class="login__input"
          id="reg-name"
          name="name"
          type="text"
          placeholder="Имя.."
          autocomplete="name"
          required
        />
      </label>

      <label class="login__label" for="reg-email">
        Email
        <input
          class="login__input"
          id="reg-email"
          name="email"
          type="email"
          placeholder="Email..."
          autocomplete="email"
          required
        />
      </label>

      <label class="login__label" for="reg-pass">
        Пароль
        <input
          class="login__input"
          id="reg-pass"
          name="password"
          type="password"
          placeholder="Пароль.."
          autocomplete="new-password"
          required
        />
      </label>

      <!-- главная фиолетовая кнопка -->
      <button class="login__btn" id="btn-register" type="submit">
        ЗАРЕГИСТРИРОВАТЬСЯ
      </button>

      <!-- "или" мелким шрифтом -->
      <p class="micro-hint">или</p>

      <!-- белая кнопка "Войти" -->
      <div class="login__links">
        <button
          class="login__btn login__btn--ghost"
          id="switch-to-login"
          type="button"
          data-action="to-login"
        >
          ВОЙТИ
        </button>
      </div>
    </form>

    <!-- ===== ЭКРАН ВХОДА ===== -->
    <form class="login__form" id="svid-form-login" data-svid-form="login" hidden novalidate>
      <label class="login__label" for="login-email">
        Email
        <input
          class="login__input"
          id="login-email"
          name="email"
          type="email"
          placeholder="Email..."
          autocomplete="username"
          required
        />
      </label>

      <label class="login__label" for="login-pass">
        Пароль
        <input
          class="login__input"
          id="login-pass"
          name="password"
          type="password"
          placeholder="Пароль.."
          autocomplete="current-password"
          required
        />
      </label>

      <!-- главная фиолетовая кнопка -->
      <button class="login__btn" id="btn-login" type="submit">
        ВОЙТИ
      </button>

      <!-- "или" мелким шрифтом -->
      <p class="micro-hint">или</p>

      <!-- белые кнопки -->
      <div class="login__links">
        <button
          class="login__btn login__btn--ghost"
          id="switch-to-register-1"
          type="button"
          data-action="to-register"
        >
          РЕГИСТРАЦИЯ
        </button>

        <button
          class="login__btn login__btn--ghost"
          id="switch-to-reset-1"
          type="button"
          data-action="to-reset"
        >
          СБРОСИТЬ ПАРОЛЬ
        </button>
      </div>
    </form>

    <!-- ===== ЭКРАН СБРОСА ПАРОЛЯ ===== -->
    <form class="login__form" id="svid-form-reset" data-svid-form="reset" hidden novalidate>
      <p class="login__text">Получить новый пароль:</p>

      <label class="login__label" for="reset-email">
        Email
        <input
          class="login__input"
          id="reset-email"
          name="email"
          type="email"
          placeholder="Email..."
          autocomplete="email"
          required
        />
      </label>

      <!-- главная фиолетовая кнопка -->
      <button class="login__btn" id="btn-reset-password" type="submit">
        ПОЛУЧИТЬ ПАРОЛЬ
      </button>

      <!-- текст под кнопкой -->
      <p class="micro-hint">
        После нажатия на кнопку мы создадим новый пароль и покажем ниже.
      </p>

      <!-- белые кнопки -->
      <div class="login__links">
        <button
          class="login__btn login__btn--ghost"
          id="switch-to-login-2"
          type="button"
          data-action="to-login"
        >
          ВОЙТИ
        </button>

        <button
          class="login__btn login__btn--ghost"
          id="switch-to-register-2"
          type="button"
          data-action="to-register"
        >
          РЕГИСТРАЦИЯ
        </button>
      </div>

      <!-- сюда выводим сгенерированный пароль -->
      <div class="login__status login__status--inline" id="reset-result" role="status" aria-live="polite"></div>
    </form>
  </div>
</section>










      </main>

      <footer id="footer" role="contentinfo"></footer>
    </div>
  </div>

  <!-- Оверлей для мобильного меню -->
  <div id="overlay" hidden></div>
  <script defer src="js/footer.js?v=2"></script>
  <script defer src="login/login.js"></script>


</body>
</html>
