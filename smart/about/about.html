<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<base href="../" />
<title>–û –ø—Ä–æ–µ–∫—Ç–µ</title>

<link rel="icon" href="assets/logo400.jpg" />
<link rel="manifest" href="manifest.json" />
<link rel="stylesheet" href="css/main.css" />
<link rel="stylesheet" href="about/about.css" />

<!-- üß† –ì–ª–æ–±–∞–ª—å–Ω—ã–π bootstrap –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
<script>
  (function () {
    const AUTH_CACHE_KEY = 'sv.auth.cache.v1';

    window.SV_AUTH = {
      isAuthenticated: false,
      userId: null,
      email: null,
      displayName: null,
      level: 1,
      levelCode: 'guest',
      loaded: false,
      _resolve: null,
      ready: null,
    };

    window.SV_AUTH.ready = new Promise(resolve => window.SV_AUTH._resolve = resolve);

    async function bootstrap() {
      try {
        const cached = localStorage.getItem(AUTH_CACHE_KEY);
        if (cached) Object.assign(window.SV_AUTH, JSON.parse(cached));

        const resp = await fetch("/api/auth/me", { method: "GET", credentials: "include" });
        const data = await resp.json();

        if (data.loggedIn) {
          const u = data.user_merged || {};
          window.SV_AUTH.isAuthenticated = true;
          window.SV_AUTH.userId = u.id || null;
          window.SV_AUTH.email = u.email || null;
          window.SV_AUTH.displayName = u.name || null;
          window.SV_AUTH.level = data.level || 2;
          window.SV_AUTH.levelCode = data.level_code || "user";
        } else {
          window.SV_AUTH.isAuthenticated = false;
          window.SV_AUTH.userId = null;
          window.SV_AUTH.level = 1;
          window.SV_AUTH.levelCode = "guest";
        }

        localStorage.setItem(AUTH_CACHE_KEY, JSON.stringify(window.SV_AUTH));
      } catch (err) { console.warn("AUTH bootstrap error:", err); }

      window.SV_AUTH.loaded = true;
      window.SV_AUTH._resolve(window.SV_AUTH);
    }

    bootstrap();
  })();
  </script>

<!-- topbar/menu -->
<script type="module">
  import { initPage } from './js/topbar.module.js';
  initPage({
    fragments: [['menu.html', '#sidebar']],
    cacheBust: false,
    topbar: { state: { logoHref: 'index.html', logoSrc: 'assets/logo400.jpg' } }
  });
</script>


<!-- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è -->
<script defer src="js/zaprosrazreshenijbrauzera.js"></script>

<!-- –ì–µ–æ-–≤–∏–¥–∂–µ—Ç -->
<script defer src="js/footer.geo.bundle.js"></script>

<script type="module" src="js/super-informer.js"></script>

</head>

<body>
<div id="page">
  <aside id="sidebar"></aside>

  <div id="app">
    <header id="topbar"></header>

    <main id="main">

      <!-- –ö–ê–†–¢–û–ß–ö–ê 0: –û –ü–†–û–ï–ö–¢–ï -->
      <section class="card about-card">
        <h1>–û –ø—Ä–æ–µ–∫—Ç–µ</h1>
        <p>–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞.</p>
      </section>


      <!-- –ö–ê–†–¢–û–ß–ö–ê 1: –†–ê–ó–†–ï–®–ï–ù–ò–Ø -->
      <section class="card">
        <h2>–†–∞–∑—Ä–µ—à–µ–Ω–∏—è</h2>

        <div class="stack-16">
          <button class="btn-purple" id="btnMic">–†–∞–∑—Ä–µ—à–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω</button>
          <button class="btn-purple" id="btnCam">–†–∞–∑—Ä–µ—à–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
          <button class="btn-purple" id="btnNoti">–†–∞–∑—Ä–µ—à–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
          <button class="btn-purple" id="btnGeo">–†–∞–∑—Ä–µ—à–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</button>
        </div>

        <p id="permStatus">status: idle</p>
      </section>


      <!-- –ö–ê–†–¢–û–ß–ö–ê 2: –ì–ï–û–õ–û–ö–ê–¶–ò–Ø -->
      <section class="card">
        <h2>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</h2>

        <div id="geo-card"></div>

        <script>
          document.addEventListener("DOMContentLoaded", () => {
            try { SVFooter.mount("geo-card"); } catch(e) { console.warn(e); }
          });
        </script>
      </section>


      <!-- –ö–ê–†–¢–û–ß–ö–ê 3: –ë–û–õ–¨–®–û–ô –ò–ù–§–û–†–ú–ï–† -->
      <section class="card">
            <h2>–ë–æ–ª—å—à–æ–π –∏–Ω—Ñ–æ—Ä–º–µ—Ä</h2>

            <div id="about-informer" class="big-informer">
              –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É–ø–µ—Ä-–∏–Ω—Ñ–æ—Ä–º–µ—Ä–∞...
            </div>

            <script type="module">
              import { collectSuperInfo } from "../js/super-informer.js";

              async function renderSuper() {
                const info = await collectSuperInfo();

                document.querySelector("#about-informer").innerHTML = `
                  <div class="inf-group">
                    <h3>SV_AUTH</h3>
                    <pre>${JSON.stringify(info.svAuth, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>Public IP</h3>
                    <pre>${JSON.stringify(info.publicIP, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>Permissions</h3>
                    <pre>${JSON.stringify(info.permissions, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>Battery</h3>
                    <pre>${JSON.stringify(info.battery, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>Device</h3>
                    <pre>${JSON.stringify(info.device, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>Screen</h3>
                    <pre>${JSON.stringify(info.screen, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>Network</h3>
                    <pre>${JSON.stringify(info.network, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>Storage</h3>
                    <pre>${JSON.stringify(info.storage, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>WebGL (GPU)</h3>
                    <pre>${JSON.stringify(info.webgl, null, 2)}</pre>
                  </div>

                  <div class="inf-group">
                    <h3>Timestamp</h3>
                    <pre>${JSON.stringify(info.timestamp, null, 2)}</pre>
                  </div>
                `;
              }

              document.addEventListener("sv:auth-ready", renderSuper);
            </script>
          </section>


    </main>
  </div>
</div>

<div id="overlay" hidden></div>

</body>
</html>
