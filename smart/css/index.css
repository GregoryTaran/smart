/* smart/css/index.css
   Полный файл стилей (минимальные и безопасные правки для стабильности тапов на мобилe)
   Автор: Smart Vision (патч: исправление overlay/footer tap issue)
   Принцип: не ломаем desktop, минимально меняем поведение на mobile.
*/

/* =========================
   CSS-переменные (настройки проекта)
   ========================= */
:root{
  --max-width: 1000px;
  --menu-width: 30%;
  --menu-mobile-width: 80%;
  --gap: 16px;
  --bg: #ffffff;
  --text: #222;
  --muted: #666;
  --accent: #007bff;
  --menu-active-bg: #e9ecef;
  --overlay-color: rgba(0,0,0,0.28);
}

/* =========================
   Базовый ресет и общие правила
   ========================= */
* { box-sizing: border-box; }
html,body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
  color: var(--text);
  background: var(--bg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-text-size-adjust: 100%;
}

/* Картинки и ссылки */
a { color: var(--accent); text-decoration: none; }
img { max-width: 100%; height: auto; display: block; }
button { font-family: inherit; cursor: pointer; }

/* =========================
   Защита от горизонтального скролла (важно для мобильных)
   ========================= */
html, body, #wrapper, .content-zone, main {
  max-width: 100%;
  overflow-x: hidden; /* предотвращаем горизонтальную прокрутку */
}
#module-root, .module-root { width: 100%; box-sizing: border-box; overflow-x: hidden; }

/* Простейшая обработка длинных слов, код-блоков и т.д. */
pre, code { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; max-width: 100%; }
p,h1,h2,h3,li,a { word-break: break-word; overflow-wrap: anywhere; }

/* =========================
   Wrapper / layout
   ========================= */
#wrapper {
  max-width: var(--max-width);
  margin: 0 auto;
  display: flex;
  min-height: 100vh;
  width: 100%;
}
.content-zone { flex: 1 1 auto; display: flex; flex-direction: column; min-height: 100vh; }

header {
  height: 64px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-bottom: 1px solid #eee;
  background: #fff;
  position: relative;
  z-index: 800; /* ниже мобильного меню */
}
main { flex: 1 1 auto; padding: 28px; overflow-x: hidden; }

footer {
  border-top: 1px solid #eee;
  padding: 12px;
  text-align: center;
  font-size: 14px;
  color: var(--muted);
  position: relative; /* по умолчанию relative — нужно для z-index */
}

/* Класс контейнера ссылок в футере (используется в HTML) */
.footer-links{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:center; }

/* =========================
   Side menu: общие стили
   ========================= */
#side-menu { background: #ffffff; color: var(--text); }
.menu-header { display:flex; align-items:center; justify-content:space-between; padding:12px; border-bottom:1px solid #f1f1f1; background:#fff; }
.menu-title { font-size:13px; color:#333; font-weight:600; }
.menu-close { background:none; border:0; font-size:18px; cursor:pointer; }
.menu-list { list-style:none; margin:0; padding:0; }
.menu-list li a {
  display:block;
  padding:12px 14px;
  border-bottom:1px solid #f2f2f2;
  color: var(--text);
  background: transparent;
  transition: background .12s, color .12s;
  text-decoration: none;
}
.menu-list li a:hover { background: #fafafa; }
.menu-list li a.active { background: var(--menu-active-bg); font-weight: 600; color: #111; }

/* =========================
   Preload / flash fixes (чтобы не было "красного квадратика" при первом рендере)
   - body.preload используется, пока DOMContentLoaded или CSS ещё не применены
   ========================= */
/* Скрываем меню в .preload, чтобы избежать визуальных артефактов */
body.preload #side-menu { visibility: hidden; opacity: 0; pointer-events: none; }
body:not(.preload) #side-menu { visibility: visible; opacity: 1; pointer-events: auto; }
body.preload #side-menu { box-shadow: none !important; }
body:not(.preload) #side-menu { box-shadow: 6px 0 20px rgba(0,0,0,0.12); }

/* =========================
   Desktop styles (>=769px)
   ========================= */
@media (min-width: 769px) {
  #side-menu {
    flex: 0 0 var(--menu-width);
    min-height: 100vh;
    border-right: 1px solid #eaeaea;
    position: relative;
    z-index: 700;
    box-shadow: 6px 0 18px rgba(0,0,0,0.03);
  }
  #menu-toggle { display: none; }
  #site-logo { max-width: 300px; width: 100%; height: auto; }
  .menu-close { display: none; }
}

/* =========================
   Mobile styles (<=768px)
   ========================= */
@media (max-width: 768px) {
  /* Layout */
  #wrapper { flex-direction: column; }

  /* Side menu fixed поверх header */
  #side-menu {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: var(--menu-mobile-width);
    transform: translateX(-100%);
    transition: transform .36s ease, opacity .12s ease;
    z-index: 1000; /* выше header */
    background: #ffffff;
    box-shadow: none;
    border-right: 1px solid rgba(0,0,0,0.06);
  }
  body.menu-open #side-menu { transform: translateX(0); }

  /* Overlay затемняет контент и блокирует клики — но по умолчанию НЕ должен перехватывать события */
  /* Изменение: делаем overlay НЕучастником hit-test'а (display:none) пока меню закрыто */
  #overlay {
    position: fixed;
    inset: 0;
    background: var(--overlay-color);
    display: none;          /* <- обязательно: удаляет элемент из hit-testing, когда он скрыт */
    opacity: 0;
    pointer-events: none;
    transition: opacity .25s;
    z-index: 950; /* ниже чем #side-menu(1000) */
  }
  /* Когда меню открыто — показываем overlay и он блокирует клики под собой */
  body.menu-open #overlay { display: block; opacity: 1; pointer-events: auto; }

  /* Логотип, кнопка меню и z-index для кнопки */
  #site-logo { max-width: 220px; width: 100%; height: auto; }
  #menu-toggle {
    position: absolute;
    left: 12px;
    font-size: 22px;
    background: none;
    border: 0;
    cursor: pointer;
    z-index: 1100; /* чуть выше overlay, чтобы кнопка всегда кликабельна */
  }
  .menu-close { display: inline-block; }
}

/* =========================
   Далее — общие мелочи и улучшения
   ========================= */

/* Плавнее overlay */
#overlay { transition: opacity .2s ease; }

/* Защита от переноса inline-block элементов */
.menu-header .menu-title { white-space: nowrap; }

/* Центровка модулей */
.main-block { max-width: 900px; margin: 0 auto; }

/* ============================================
   FIX: сделать футер точно кликабельным на mobile
   (минимальная, безопасная правка — локальная и пояснённая)
   ============================================
   Проблема: при первом рендере / на некоторых устройствах прозрачный или скрытый
   overlay/другой фиксированный элемент может перехватывать события, и футер
   оказывается некликабельным. Простое pointer-events или opacity не всегда
   спасают в разных браузерах (особенно при анимациях).
   Решение:
   - Когда меню ЗАКРЫТО (body:not(.menu-open)) — повышаем stacking и включаем
     pointer-events у футера, чтобы он был выше любых невидимых слоёв.
   - Когда меню ОТКРЫТО (body.menu-open) — возвращаем нормальное поведение
     (overlay блокирует клики).
   Это безопасно: мы поднимаем футер в стэке только если меню закрыто.
*/

/* 1) Улучшение отклика тапов на ссылки футера всегда */
.footer-links a {
  touch-action: manipulation;      /* уменьшает вероятность конфликтов жест/тап */
  -webkit-tap-highlight-color: rgba(0,0,0,0.05);
}

/* 2) При закрытом меню — делаем футер "выше" (чтобы избежать непредвиденных прозрачных слоёв),
   и гарантируем pointer-events: auto (кликабельность).
   ПРИМЕЧАНИЕ: используем точный селектор body:not(.menu-open) — это гарантирует,
   что при реальном открытом меню (menu-open) поведение не изменится. */
body:not(.menu-open) footer,
body:not(.menu-open) .site-footer,
body:not(.menu-open) .footer-links {
  position: relative;   /* гарантируем, что z-index работает */
  z-index: 2000;        /* выше любого скрытого/невидимого overlay'а */
  pointer-events: auto; /* явно разрешаем клики по футеру */
}

/* 3) При открытом меню — возвращаем разумные z-index и позволяем overlay блокировать клики */
body.menu-open footer,
body.menu-open .site-footer,
body.menu-open .footer-links {
  z-index: auto;
  pointer-events: none; /* защищаем от кликов под overlay — overlay должен блокировать */
}

/* =========================
   Дополнительные мелкие улучшения / debug
   ========================= */
/* slightly reduce hover contrast */
.menu-list li a:focus,
.menu-list li a:active { outline: none; background: #f7f9fa; }

/* debug helper (комментируй если не нужен) */
/* .debug-outline * { outline: 1px dashed rgba(255,0,0,0.08); } */
