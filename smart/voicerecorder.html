<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voice Recorder</title>

  <!-- === ОБЩИЕ СТИЛИ САЙТА (menu/topbar/footer и т.д.) — НЕ УДАЛЯЙ === -->
  <link rel="stylesheet" href="css/main.css">

  <!-- Стили конкретно этого модуля (оставляем как в стабильной версии) -->
  <link rel="stylesheet" href="voicerecorder/voicerecorder.css">

  <!-- mic-indicator styles (в папке voicerecorder/mic-indicator/) -->
  <link rel="stylesheet" href="voicerecorder/mic-indicator/mic-indicator.css">
</head>
<body>
  <!-- topbar/menu вставляется сервером/шаблоном вашего проекта (не меняем) -->

  <main id="main" data-module="voicerecorder">
    <section class="vc-recorder" aria-labelledby="vc-title">
      <h1 id="vc-title" class="vc-title">ДИКТОФОН</h1>

      <div class="vc-controls" role="region" aria-label="Управление записью">
        <button id="vc-btn-start" class="vc-btn vc-btn-start">СТАРТ</button>
        <button id="vc-btn-pause" class="vc-btn vc-btn-pause" disabled>ПАУЗА</button>
        <button id="vc-btn-stop" class="vc-btn vc-btn-stop" disabled>СТОП</button>
      </div>

      <div class="vc-visualizer" aria-hidden="false">
        <div class="vc-waveform" aria-hidden="true"></div>

        <!-- Контейнер индикатора: ширина контролируется внешним CSS -->
        <div id="vc-level" class="vc-level" aria-hidden="false"></div>
      </div>

      <div class="vc-result">
        <div class="vc-player">
          <audio id="vc-audio" controls></audio>

          <!-- Транскрипт: НА СЛЕДУЮЩЕЙ СТРОКЕ под плеером (как просил) -->
          <div class="vc-transcript" aria-live="polite">
            <h2 class="vc-sub">Текстовая версия</h2>
            <div id="vc-transcript" class="vc-transcript-box" contenteditable="false"></div>
          </div>

          <a id="vc-download" class="vc-download" href="#" download style="display:none">Скачать</a>
        </div>
      </div>

      <div id="vc-status" class="vc-status" aria-live="status">Готов</div>
    </section>
  </main>

  <!-- mic-indicator: создаём экземпляр, НО НЕ ПРИСОЕДИНЯЕМ stream автоматически -->
  <script type="module">
    import MicIndicator from './voicerecorder/mic-indicator/mic-indicator.js';
    // создаём экземпляр в контейнере, но не подключаем stream здесь
    // attachStream будет вызван в voicerecorder.js при старте записи
    window._SV_MIC_INDICATOR = window._SV_MIC_INDICATOR || new MicIndicator(document.getElementById('vc-level'));
  </script>

  <!-- основная логика модуля (стабильная версия) -->
  <script type="module" src="voicerecorder/voicerecorder.js"></script>

  <!-- footer/footer scripts сайта (не трогаем) -->
</body>
</html>
