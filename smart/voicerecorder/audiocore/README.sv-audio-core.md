# üéß SV Audio Core (with Compressor & Make-up)

## üìñ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∑–∞—Ö–≤–∞—Ç –∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–≤—É–∫–∞ –∏–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ —Å –ø–æ–º–æ—â—å—é **Web Audio API** –∏ **AudioWorklet**.  
–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –ø–æ–ª—É—á–∏—Ç—å **—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø–æ –≥—Ä–æ–º–∫–æ—Å—Ç–∏** –∏ **–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π** –∞—É–¥–∏–æ–ø–æ—Ç–æ–∫, –¥–∞–∂–µ –µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –≥–æ–≤–æ—Ä–∏—Ç —Ç–æ –≥—Ä–æ–º–∫–æ, —Ç–æ —Ç–∏—Ö–æ, –∏–ª–∏ –∫—Ä–∏—á–∏—Ç —Ä—è–¥–æ–º —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º.

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ü–µ–ø–æ—á–∫–∏

```
üéô –ú–∏–∫—Ä–æ—Ñ–æ–Ω (MediaStream)
    ‚Üì
üéö preGain ‚Äî —Ä—É—á–Ω–æ–π –≤—Ö–æ–¥–Ω–æ–π —É—Å–∏–ª–∏—Ç–µ–ª—å
    ‚Üì
üß† compressor ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä (–ø—Ä–∏–∂–∏–º–∞–µ—Ç –ø–∏–∫–∏)
    ‚Üì
üéõ makeUpGain ‚Äî –ø–æ–¥–Ω–∏–º–∞–µ—Ç –æ–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è
    ‚Üì
üß© recorder.worklet ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç —á–∞–Ω–∫–∏ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç —Ñ—Ä–µ–π–º—ã Float32Array –Ω–∞—Ä—É–∂—É
```

> –ï—Å–ª–∏ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä –≤—ã–∫–ª—é—á–µ–Ω (`VR_ENABLE_COMPRESSOR = false`), —Ü–µ–ø–æ—á–∫–∞ —É–ø—Ä–æ—â–∞–µ—Ç—Å—è –¥–æ  
> `source ‚Üí preGain ‚Üí recorder`.

---

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|--------------|-------------|
| **–†—É—á–Ω–æ–π Gain** | –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –¥–æ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–∞ (`VR_MANUAL_GAIN`) |
| **–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä** | –ü—Ä–∏–∂–∏–º–∞–µ—Ç –≥—Ä–æ–º–∫–∏–µ —É—á–∞—Å—Ç–∫–∏, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏–∫—É (`VR_COMP_*`) |
| **Make-up Gain** | –ü–æ–≤—ã—à–∞–µ—Ç –æ–±—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ—Å–ª–µ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ (`VR_MAKEUP_GAIN`) |
| **–ê–≤—Ç–æ-Make-up** | –ú–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç make-up –ø–æ —Ç–µ–∫—É—â–µ–π –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ (`VR_AUTOMAKEUP_*`) |
| **AEC / NS / AGC** | –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å, –Ω–æ –æ–±—ã—á–Ω–æ –≤—ã–∫–ª—é—á–µ–Ω—ã) |
| **–ü–∞—É–∑–∞ / –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** | –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–≤–∞—Ç—å —Ü–µ–ø–æ—á–∫—É –∏ —ç–∫–æ–Ω–æ–º–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã |
| **Worklet** | –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∞—É–¥–∏–æ-–ø–æ—Ç–æ–∫–µ, —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å–æ–±–∏—Ä–∞—è —á–∞–Ω–∫–∏ –±–µ–∑ –ª–∞–≥–æ–≤ |

---

## üîß –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞)

| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥. –¥–∏–∞–ø–∞–∑–æ–Ω |
|------------|-----------|--------------------|
| `VR_COMP_THRESHOLD_DB` | –ü–æ—Ä–æ–≥ —Å–∂–∞—Ç–∏—è, –¥–ë | -18‚Ä¶-30 |
| `VR_COMP_RATIO` | –°–∏–ª–∞ —Å–∂–∞—Ç–∏—è | 6‚Äì14 |
| `VR_COMP_ATTACK_SEC` | –í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ | 0.002‚Äì0.005 |
| `VR_COMP_RELEASE_SEC` | –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è | 0.1‚Äì0.4 |
| `VR_MAKEUP_GAIN` | –ü–æ–¥—ä—ë–º –ø–æ—Å–ª–µ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–∞ | 1.2‚Äì2.0 |
| `VR_AUTOMAKEUP_ENABLED` | –í–∫–ª/–≤—ã–∫–ª –∞–≤—Ç–æ-–ø–æ–¥—Å—Ç—Ä–æ–π–∫—É | `true / false` |
| `VR_MANUAL_GAIN` | –í—Ö–æ–¥–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–æ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–∞ | 0.5‚Äì1.5 |

> ‚ö†Ô∏è –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω `VR_AUTOMAKEUP_ENABLED`, —Ç–æ `make-up` –±—É–¥–µ—Ç –ø–ª–∞–≤–Ω–æ –º–µ–Ω—è—Ç—å—Å—è —Å–∞–º,  
> –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞—è—Å—å –ø–æ–¥ —Ç–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç —Ä–µ—á–∏
- –ó–∞–ø—É—Å—Ç–∏ –º–æ–¥—É–ª—å, –≥–æ–≤–æ—Ä–∏ —Ä–∞–∑–Ω–æ–π –≥—Ä–æ–º–∫–æ—Å—Ç—å—é.  
- –ï—Å–ª–∏ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:  
  - –≥—Ä–æ–º–∫–∏–µ —Å–ª–æ–≤–∞ –Ω–µ ¬´—Ä–≤—É—Ç¬ª –∑–≤—É–∫;  
  - —Ç–∏—Ö–∏–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è.

### 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
- –û—Ç–æ–π–¥–∏ –Ω–∞ 1 –º–µ—Ç—Ä –∏ –≥–æ–≤–æ—Ä–∏, –ø–æ—Ç–æ–º –ø–æ–¥–æ–π–¥–∏ –≤–ø–ª–æ—Ç–Ω—É—é –∏ –∫—Ä–∏–∫–Ω–∏.  
- –£—Ä–æ–≤–µ–Ω—å –∑–∞–ø–∏—Å–∏ –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º.

### 3. –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
- –í–∫–ª—é—á–∏ –º—É–∑—ã–∫—É –∏–ª–∏ –±–∏—Ç –Ω–∞ —Ñ–æ–Ω–µ –∏ –≥–æ–≤–æ—Ä–∏ –ø–æ–≤–µ—Ä—Ö.  
- –ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä –¥–æ–ª–∂–µ–Ω –¥–µ—Ä–∂–∞—Ç—å –≥–æ–ª–æ—Å —Å—Ç–∞–±–∏–ª—å–Ω–æ ¬´–ø–æ–≤–µ—Ä—Ö¬ª —Ñ–æ–Ω–æ–≤–æ–≥–æ —à—É–º–∞.

---

## üí° –ü—Ä–∏–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```js
import SVAudioCore from './sv-audio-core.with-compressor.js';

const audio = new SVAudioCore();

await audio.init();
audio.onAudioFrame = (frame) => {
  // frame ‚Äî Float32Array, –≥–æ—Ç–æ–≤—ã–π –∞—É–¥–∏–æ—Ñ—Ä–∞–≥–º–µ–Ω—Ç
  console.log('–ü–æ–ª—É—á–µ–Ω —Ñ—Ä–µ–π–º', frame.length);
};

// –ü—Ä–∏–º–µ—Ä: –≤–∫–ª—é—á–∏—Ç—å –ø–ª–∞–≤–Ω—É—é –ø–æ–¥—Å—Ç—Ä–æ–π–∫—É make-up
audio.startAutoMakeup({ targetReduction: -6 });
```
 
---

## üß± –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä –∏ make-up —Ä–∞–±–æ—Ç–∞—é—Ç **–¥–æ** –∑–∞–ø–∏—Å–∏ –≤ Worklet, —Ç.–µ. –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.  
- `recorder.worklet.js` **–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç** –∞—É–¥–∏–æ ‚Äî –æ–Ω –ø—Ä–æ—Å—Ç–æ –æ—Ç–¥–∞—ë—Ç —Å—ã—Ä—ã–µ —Ñ—Ä–µ–π–º—ã.  
- –î–ª—è –∂—ë—Å—Ç–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å ¬´–º—è–≥–∫–∏–π –ª–∏–º–∏—Ç–µ—Ä¬ª –≤ Worklet (–ø–æ –∂–µ–ª–∞–Ω–∏—é).  
- –ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å Chrome, Edge –∏ Firefox. Safari –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å `applyConstraints`.

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä—ã

**Greg Taran** & **ChatGPT-Bro**  
> –ú–∏—Å—Å–∏—è: –Ω–∞—É—á–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä –Ω–µ –±–æ—è—Ç—å—Å—è –≥—Ä–æ–º–∫–∏—Ö —ç–º–æ—Ü–∏–π üòÑ  
> *"–ï—Å–ª–∏ —Ç—ã –∫—Ä–∏—á–∏—à—å ‚Äî –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä –ø–æ–π–º—ë—Ç —Ç–µ–±—è –ø–µ—Ä–≤—ã–º."*
