"ПУТЬ ПО ВИЗИИ"

Модуль будет поддерживать человека в пути по его визии.

1. Человек уже в логине и имеет id
2. Пользователь нажимает создать визию и назывет ее как-то или она сама называется исходя из диалога. но название должно быть и дата создания. Это как бы наш главный объект - "визия" с которым мы будем работать.
3. Дальше человек будет говорить или писать, мы будем отвечать, советовать, искать, поддерживать, создавать, и тд.
Будет диалог который мы будем хранить.
4. Что в итоге:
- Путь-процесс нашего движения по визии.
- Если человек уже не хочет можно заморозить визию и отправить в архив.
- Если человек не хочет можно удалить визию, мы будем скрывать визию их интерфейса, что бы не ломать базу.

ИНТЕРФЕЙС
1. Для начала все будет на одной длинной странице, где мы попробуем все сделать удобно.

СТЕК:
фастПАИ и пайтон, фронт хтмл и ЖС, база супабейз.

1. Название и цель модуля

Название: «ПУТЬ ПО ВИЗИИ»
Цель: поддерживать человека в движении к его визии через диалог с системой, фиксируя:
1. сам объект «визия»,
2. весь путь-процесс (историю взаимодействий),
3. статусы визии (активна / заморожена / в архиве / удалена с точки зрения интерфейса).

Состояния/события пути - предлагаю потом добавить, сейчас очень сложно для меня. 

ОБЬЕКТЫ:
1. Пользователь. Пользователь уже авторизован в системе. У пользователя есть уникальный user_id (приходит из существующей auth-системы).
2. Визия (Vision) - Главный объект.
3. Сообщения диалога (VisionMessage). Диалог человека и системы внутри конкретной визии.
мне нужно понять как архитектруно завязать все что будет нами сделанно кромен диалога, например мы сделали пользовтателю выборку, и она в виде вайла, это тоже диалог? или это уже другая сущность?

Пользовательские сценарии:
1. Пользователь (уже залогинен) нажимает кнопку «Создать визию».
2. Система: формирует «черновое» название (например, «Визия от 14.11.2025») и уже потом даёт в списке визий возможность отредактировать или  в другом месте, но потом, сейчас просто создать - создал! не будем усложнять это на начальном этапе, главное что у визии есть id и автоматом текстовое название. так нам будет проще делать суть, а не ебатся с юзер интерфейсом.
3. Пользователь говорит или пишет сообщение. оно уходит и запоминается. Для начальном этапе мы не думаем о редактуре после отправке, позже сделаем интерфейс. Если запись законченна или текст отправлен сущность готова и поехала на сервер.
4. От сервера приехал наш ответ (аудио, текст, и все что нужно еще) пользователь увидел ответ или прослушал или загрузил или еще что, пока не важно, пока нужно просто гарантировано сделать продукт который будет работать. 
если говорить о первичном ЮИ это будет просто блочный вывод на странице вопрос - ответ - вопросы - ответ - вопрос - ответ и тд.
5. что важно для сервера!
-  сохранить все что получено
- сохранить все что отправлено

АГРЕГИРУЕМ ЗАПРОСЫ
- «Агрегировать запрос в GPT из истории». MVP-логика: Берём все сообщения по визии (SELECT * FROM vision_messages WHERE vision_id = ... ORDER BY created_at). Сериализуем их в формат «диалога» для GPT: роли user / assistant, текстовые части. Отправляем весь диалог в GPT.
Но чтобы не умереть от токенов, сразу строим управляемую константу: Конфиг, например: MAX_MESSAGES = 50

ВЫВОД СООБЩЕНИЙ
- «На начальном MVP каждый раз при первичном запросе визии отправлять клиенту все переписки. Когда пользователь открывает визию:
фронт делает запрос: «дай мне все сообщения по визии» (или последние N). сервер отдаёт список сообщений. фронт сохраняет их у себя в памяти (в JS).  
Когда пользователь отправляет новое сообщение: фронт отправляет только новое сообщение. сервер: сохраняет сообщение пользователя,
вызывает GPT, сохраняет ответ ассистента, возвращает только ответ ассистента (или «пакет» из двух новых сообщений). фронт просто добавляет новые сообщения к уже имеющимся.
сервер отвечает только новым, фронт сам знает, что он уже показал остальное. Если страница перезагрузилась: фронт снова запрашивает историю (GET всех сообщений/последних N), отображает.

ПОЖЕЛАНИЯ:
1. пока я не пойму суть, не будем думать о ЮИ, по резултату нашего диалога, я нарисую его сам без тебя и тогда мы его обсудим.
сейчас говорим обо всем кроме ЮИ.
2 API (черновой контракт FastAPI) составим когда когда будем все знать что мы хотим, тогда и сделаем апи.





